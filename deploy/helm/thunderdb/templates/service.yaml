apiVersion: v1
kind: Service
metadata:
  name: {{ include "thunderdb.fullname" . }}
  labels:
    {{- include "thunderdb.labels" . | nindent 4 }}
spec:
  type: {{ .Values.service.type }}
  selector:
    {{- include "thunderdb.selectorLabels" . | nindent 4 }}
  ports:
    - name: postgres
      port: {{ .Values.service.ports.postgres }}
      targetPort: postgres
      protocol: TCP
    - name: mysql
      port: {{ .Values.service.ports.mysql }}
      targetPort: mysql
      protocol: TCP
    - name: resp
      port: {{ .Values.service.ports.resp }}
      targetPort: resp
      protocol: TCP
    - name: http
      port: {{ .Values.service.ports.http }}
      targetPort: http
      protocol: TCP
    - name: grpc
      port: {{ .Values.service.ports.grpc }}
      targetPort: grpc
      protocol: TCP
---
# Headless service for internal cluster communication and DNS discovery
apiVersion: v1
kind: Service
metadata:
  name: {{ include "thunderdb.fullname" . }}-headless
  labels:
    {{- include "thunderdb.labels" . | nindent 4 }}
spec:
  type: ClusterIP
  clusterIP: None
  publishNotReadyAddresses: true
  selector:
    {{- include "thunderdb.selectorLabels" . | nindent 4 }}
  ports:
    - name: grpc
      port: {{ .Values.service.ports.grpc }}
      targetPort: grpc
      protocol: TCP
    - name: postgres
      port: {{ .Values.service.ports.postgres }}
      targetPort: postgres
      protocol: TCP
    - name: mysql
      port: {{ .Values.service.ports.mysql }}
      targetPort: mysql
      protocol: TCP
    - name: resp
      port: {{ .Values.service.ports.resp }}
      targetPort: resp
      protocol: TCP
    - name: http
      port: {{ .Values.service.ports.http }}
      targetPort: http
      protocol: TCP
